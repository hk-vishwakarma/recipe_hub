{% extends "base.html" %}
{% load static %}

{% block title %}{{ recipe.title }}{% endblock %}

{% block content %}
<section class="max-w-4xl mx-auto px-6 py-12">
    <div class="bg-white shadow-lg rounded-lg overflow-hidden">
        <!-- Recipe Image -->
        {% if recipe.image %}
        <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="w-full h-80 object-cover">
        {% else %}
        <img src="{% static 'recipes/images/default.jpg' %}" alt="Placeholder" class="w-full h-80 object-cover">
        {% endif %}

        <!-- Recipe Info -->
        <div class="p-8">

            <div class="flex justify-between items-center mb-3">
                <h1 class="text-4xl font-bold text-gray-800 mb-4 inline">{{ recipe.title }}</h1>
                
                
                <!-- Category -->
                {% if recipe.category %}
                <span class="inline-block bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-sm font-semibold mb-4">
                    {{ recipe.category.name }}
                </span>
                {% endif %}
            </div>
            

            <!-- rating of recipe -->
            <div class="flex items-center mb-4">
                {% for i in "12345" %} {# 1 to 5 loop #}
                {% if avg_rating|add:0 >= i|add:0 %}
                <!-- Full Star -->
                <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 
                                                1.902 0l1.347 4.134a1 1 0 
                                                00.95.69h4.356c.969 0 1.371 1.24.588 
                                                1.81l-3.523 2.56a1 1 0 
                                                00-.364 1.118l1.347 4.134c.3.921-.755 
                                                1.688-1.54 1.118l-3.523-2.56a1 1 
                                                0 00-1.176 0l-3.523 2.56c-.784.57-1.838-.197-1.54-1.118l1.347-4.134a1 1 
                                                0 00-.364-1.118L2.08 9.561c-.783-.57-.38-1.81.588-1.81h4.356a1 1 0 
                                                00.95-.69l1.347-4.134z" />
                </svg>
                {% else %}
                <!-- Empty Star -->
                <svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 
                                                1.603-.921 1.902 0l1.347 4.134a1 1 0 
                                                00.95.69h4.356c.969 0 1.371 1.24.588 
                                                1.81l-3.523 2.56a1 1 0 
                                                00-.364 1.118l1.347 4.134c.3.921-.755 
                                                1.688-1.54 1.118l-3.523-2.56a1 1 
                                                0 00-1.176 0l-3.523 2.56c-.784.57-1.838-.197-1.54-1.118l1.347-4.134a1 1 
                                                0 00-.364-1.118L2.08 9.561c-.783-.57-.38-1.81.588-1.81h4.356a1 1 0 
                                                00.95-.69l1.347-4.134z" />
                </svg>
                {% endif %}
                {% endfor %}
                <!-- <span class="text-gray-600 font-medium ml-2">{{ avg_rating }}/5</span> -->
            </div>

            

            <!-- Description -->
            <p class="text-gray-700 mb-6">{{ recipe.description }}</p>

            <!-- Ingredients -->
            <div class="mb-6">
                <h2 class="text-2xl font-semibold mb-2">Ingredients</h2>
                <ul class="list-disc list-inside text-gray-700">
                    {% for ingredient in ingredients_list %} 
                    <li>{{ ingredient }}</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Instructions -->
            <div>
                <h2 class="text-2xl font-semibold mb-2">Instructions</h2>
                <p class="text-gray-700 whitespace-pre-line">{{ recipe.instructions }}</p>
            </div>
        </div>
    </div>
</section>

<!-- Feedback Form -->
<section class="bg-white shadow-lg rounded-lg p-8 max-w-2xl mx-auto mt-10">
    <h2 class="text-2xl font-bold mb-6 text-center text-orange-500">Give Feedback</h2>

    <form method="POST" action="">
        {% csrf_token %}

        <!-- Name -->
        <div class="mb-5">
            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
            <input type="text" name="name" id="name" placeholder="Enter your name"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition"
                required>
        </div>

        <!-- Rating -->
        <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-1">Rating</label>
            <div class="flex space-x-1 rating-input">
                {% for i in "12345" %}
                <svg data-value="{{ forloop.counter }}" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                    class="w-8 h-8 cursor-pointer text-gray-300 hover:text-yellow-400 transition">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.944a1 1 0 00.95.69h4.145c.969 0 1.371 1.24.588 1.81l-3.356 2.437a1 1 0 00-.364 1.118l1.286 3.944c.3.921-.755 1.688-1.54 1.118l-3.356-2.437a1 1 0 00-1.176 0l-3.356 2.437c-.784.57-1.838-.197-1.54-1.118l1.286-3.944a1 1 0 00-.364-1.118L2.98 9.371c-.783-.57-.38-1.81.588-1.81h4.145a1 1 0 00.95-.69l1.286-3.944z" />
                </svg>
                {% endfor %}
            </div>
            <input type="hidden" name="rating" id="rating-value" required>
        </div>

        <!-- Feedback -->
        <div class="mb-6">
            <label for="feedback" class="block text-sm font-medium text-gray-700 mb-1">Your Feedback</label>
            <textarea name="feedback" id="feedback" rows="4" placeholder="Share your thoughts..."
                class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition"
                required></textarea>
        </div>

        <!-- Submit -->
        <button type="submit"
            class="w-full py-2 px-4 bg-orange-500 text-white font-semibold rounded-lg shadow-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-offset-2 transition">
            Submit Feedback
        </button>
    </form>
</section>



<!-- final feedback with swiper-->

{% if feedbacks %}
<section class="mt-12">
    <h2 class="text-2xl md:text-3xl font-bold text-center mb-8 text-orange-500">What People Say</h2>

    {% if feedbacks|length > 1 %}
    <!-- Swiper container -->
    <div class="feedback-swiper-container relative">
        <div class="swiper feedback-swiper rounded-xl">
            <div class="swiper-wrapper">

                {% for fb in feedbacks %}
                <div class="swiper-slide " >
                    <article class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-orange-400">
                        <p class="text-gray-700 italic leading-relaxed">“{{ fb.comment }}”</p>

                        <div class="mt-4 flex items-center justify-center"
                            aria-label="Rating: {{ fb.rating }} out of 5">
                            {% for _ in "12345" %}
                            {% if forloop.counter <= fb.rating %} <!-- full star -->
                                <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"
                                    aria-hidden="true">
                                    <path
                                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.347 4.134a1 1 0 0 0 .95.69h4.356c.969 0 1.371 1.24.588 1.81l-3.523 2.56a1 1 0 0 0-.364 1.118l1.347 4.134c.3.921-.755 1.688-1.54 1.118l-3.523-2.56a1 1 0 0 0-1.176 0l-3.523 2.56c-.784.57-1.838-.197-1.54-1.118l1.347-4.134a1 1 0 0 0-.364-1.118L2.08 9.561c-.783-.57-.38-1.81.588-1.81h4.356a1 1 0 0 0 .95-.69l1.347-4.134z" />
                                </svg>
                                {% else %}
                                <!-- empty star -->
                                <svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20"
                                    aria-hidden="true">
                                    <path
                                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.347 4.134a1 1 0 0 0 .95.69h4.356c.969 0 1.371 1.24.588 1.81l-3.523 2.56a1 1 0 0 0-.364 1.118l1.347 4.134c.3.921-.755 1.688-1.54 1.118l-3.523-2.56a1 1 0 0 0-1.176 0l-3.523 2.56c-.784.57-1.838-.197-1.54-1.118l1.347-4.134a1 1 0 0 0-.364-1.118L2.08 9.561c-.783-.57-.38-1.81.588-1.81h4.356a1 1 0 0 0 .95-.69l1.347-4.134z" />
                                </svg>
                                {% endif %}
                                {% endfor %}
                        </div>

                        <p class="mt-3 text-sm text-gray-500 font-medium">— {{ fb.name }}</p>
                    </article>
                </div>
                {% endfor %}

            </div>

            <!-- Optional pagination + arrows -->
            <div class="swiper-pagination"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>
    </div>
    {% else %}
    <!-- Single feedback (no carousel needed) -->
    {% for fb in feedbacks %}
    <article class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-orange-400 max-w-xl mx-auto">
        <p class="text-gray-700 italic leading-relaxed">“{{ fb.comment }}”</p>
        <div class="mt-4 flex items-center justify-center" aria-label="Rating: {{ fb.rating }} out of 5">
            {% for _ in "12345" %}
            {% if forloop.counter <= fb.rating %} <svg class="w-5 h-5 text-yellow-400" fill="currentColor"
                viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 ..." /></svg>
                {% else %}
                <svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 ..." />
                </svg>
                {% endif %}
                {% endfor %}
        </div>
        <p class="mt-3 text-sm text-gray-500 font-medium">— {{ fb.name }}</p>
    </article>
    {% endfor %}
    {% endif %}
</section>
{% endif %}






<!-- new feedback -->
<!-- Feedback Carousel -->

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const stars = document.querySelectorAll(".rating-input svg");
        const ratingValue = document.getElementById("rating-value");

        stars.forEach(star => {
            star.addEventListener("click", function () {
                const value = this.getAttribute("data-value");
                ratingValue.value = value;
                stars.forEach(s => s.classList.remove("text-yellow-400"));
                for (let i = 0; i < value; i++) {
                    stars[i].classList.add("text-yellow-400");
                }
            });
        });
    });
</script>



<script>
    // Only init if there are multiple slides
    document.addEventListener('DOMContentLoaded', function () {
        var wrapper = document.querySelector('.feedback-swiper .swiper-wrapper');
        if (!wrapper) return;

        var slideCount = wrapper.children.length;
        if (slideCount <= 1) return; // single feedback fallback already handled

        new Swiper('.feedback-swiper', {
            loop: true,
            speed: 600,
            centeredSlides: true,
            grabCursor: true,
            autoplay: {
                delay: 3000,
                disableOnInteraction: false,
                pauseOnMouseEnter: true
            },
            // show side slides and let them peek
            slidesPerView: 1.2,
            spaceBetween: 24,
            breakpoints: {
                640: { slidesPerView: 1.6, spaceBetween: 24 },
                768: { slidesPerView: 2.2, spaceBetween: 28 },
                1024: { slidesPerView: 3, spaceBetween: 32 }
            },
            // Optional UI
            pagination: { el: '.swiper-pagination', clickable: true },
            navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }
        });
    });
</script>




{% endblock %}